# Getting Started with Firebase and React
# React Firebase
Earlier on, we learned how to add Firebase to our jQuery todo app so that we could hold on to our todos, even after page refresh.

We're now going to learn how to add Firebase to a React project so that our applications can have their own database/backend.

Having a database for our application opens up a ton of possibilities for the kinds of applications we can build - our apps can have users, and each one of those users can have a customized experience interacting with our website based on their preferences.

## Setting up Firebase
As always, the first thing that we'll need to do is create a new project inside our Firebase dashboard.

1. Head over to [firebase.google.com](https://firebase.google.com) and click 'Go to console' in the top right corner.

2. Click 'Create New Project'.

3. Give your new project a name and click 'Create Project'.

4. Click 'Add Firebase to your web app'. This will give you the embed code to add Firebase to your project.

5. You're now ready to hook your React project up to Firebase. Create a new app by running  `create-react-app book-shelf`.

6. We will also need to install `firebase` , run `npm install firebase` 

7. In your `src` folder create a filed `firebase.js` and add the following lines
```javascript
import firebase from 'firebase';

// Initialize Firebase
const config = {
	apiKey: "AIzaSyAs8R3gyKI9pnUyls5jwruEPGlUoTC1RJE",
	authDomain: "fir-bookshelf-8d68a.firebaseapp.com",
	databaseURL: "https://fir-bookshelf-8d68a.firebaseio.com",
	projectId: "fir-bookshelf-8d68a",
	storageBucket: "fir-bookshelf-8d68a.appspot.com",
	messagingSenderId: "548100999451"
};
firebase.initializeApp(config);

// this exports the CONFIGURED version of firebase
export default firebase;
```

## Getting Data from Firebase
Let's imagine that we were building a digital bookshelf that kept track of all of our favourite books, and populate our Firebase database with some dummy data.

In your Firebase console, click the Database tab. You should see a screen appear that looks something like this:

Let's add some books to our bookshelf. Click the green plus next to the name of our database and let's add some lines with your favourite books:

```
book1: "Beloved"
book2: "The Hitchhiker's Guide to the Galaxy"
book3: "A Little Life"
```

Now that we have some data, let's build a little React app that can grab it. Let’s import firebase into the `App.js` component and set up an initial `book` state.

```javascript
import React, { Component} from 'react';
import firebase from './firebase';

class App extends Component {
  render() {
    return (
      <div></div>
    )
  }
}
```

In React, when we grab data from our external sources to be used in our app, we need somewhere to store that information. Typically, this is stored in our component's state.

Let's prepare our state to receive some books and tell our render method what to do with the books once we've got them:

```javascript
class App extends Component {
  constructor() {
    super();
    this.state = {
      books: []
    }
  }
  render() {
    return (
      <ul>

      return(
        {this.state.books.map((book) => {
          <li>{book}</li>
        })}
      )
      </ul>
    )
  }
}
```

Now our component will map through our books array, grabbing any books it finds in there and display them as a list on the page.

All that's left to do is grab our data from Firebase. We'll do this by using the `componentDidMount` lifecycle hook to grab the data we want and store it in the state.

```javascript
class App extends Component {
 // ...rest of our code here
 componentDidMount() {
   const dbRef = firebase.database().ref();
   dbRef.on('value', (response) => {
     console.log(response.val());
   });
 }
}
```

If this worked successfully, you should see your books appear as an object in the console!

Let's break down what's happening here:

1. `dbRef = firebase.database().ref()`: First we create a variable called `dbRef` and point it towards our firebase database.

2. `dbRef.on('value', (response) => {`: We then add an event listener to the variable that will update us on changes to our database, and provide us a callback function to directly access the data from our database (here we named the parameter `response`).

3. `console.log(response.val())`  : We use the `val()` method to grab our database information and print it out into the console.

## Storing Firebase Data in State

Now that we're seeing our data, we need to store it in the state. Let's update our `componentDidMount` function to do that:

```javascript
const dbRef = firebase.database().ref();
dbRef.on('value', (response) => {
  const newState = [];
  const data = response.val();

  for (let key in data) {
    newState.push(data[key]);
  }

  this.setState({
    books: newState
  });

});
```

There's a lot of new code here, so let's break down exactly what we're doing:

1. `const newState = []` : When we set set (or re-set) the state of our component, we need to create a variable that will store the new state we want to introduce to our app.

2. `const data = res.val()`: Here we store our response inside of a `data` variable so that it's easier to reference later

3. `for (let key in data) {`: We need to iterate through our `data` object so that we can grab all the book names out of it!

4. `newState.push(data[key]);`:  We push all of the books into our `newState` array, which is a temporary array we only need inside this function.

5. `this.setState({ books: newState });` : We call `this.setState` in order to update our component's state with our `newBooks` array.

If this worked successfully, you'll notice that the book titles are now appearing on the page! You'll also notice if you go into your database and add a new book, it will appear on the page. Dang!

## Updating Data
Now we're able to successfully retrieve and display information from our database, but we still don't have a way to add new books to our bookshelf. Let's add that functionality now!

We'll need to add an input and an 'Add Book' button to our App component:

```js
class App extends Component {
  constructor() {
    super();
    this.state = {
      books: []
    }
  }
    render() {
      return (
        <div>
          <ul>
          {this.state.books.map((book) => {
            return (
              <li>
                {book}
              </li>
            )
          })}
          </ul>
          <input type="text" placeholder="Add a book to your bookshelf" />
          <button>Add Book</button>
        </div>
      )
    }

    componentDidMount() {
      // ....
    }
}
```

Now we have an input and a button, but they currently don't do anything! Let's start by attaching a `handleChange` method to store information about what the user is typing into the input field within our state:

```javascript
constructor() {
  super();
  this.state = {
    books: [],
    userInput: ''
  }
}

handleChange = (event) => {
  this.setState({userInput: event.target.value})
}

render() {
  return (
    <div>
      <ul>
      {this.state.books.map((book) => {
        return (
          <li>
            {book}
          </li>
        )
      })}
      </ul>
      <input type="text" onChange={this.handleChange} placeholder="Add a book to your bookshelf" />
      <button onClick={this.handleClick}>Add Book</button>
    </div>
  )
}
```

1. We've attached the `handleChange` method to our input field.

2. It will be triggered any time the field is "changed" – that is, whenever the user types in it.

3. Every time this happens, React updates the state of our App component to be equal to whatever is currently in the input field.

We can see exactly how this is working with a quick glance at the React dev tools. You'll see that `this.state.userInput` is being updated dynamically as you type in the text field!

Now let's add our `handleClick` method:

```javascript
constructor() {
  // ..
}

handleChange(event) {
  // ..
}

handleClick() {
  const dbRef = firebase.database().ref();
  dbRef.push(this.state.userInput);
  this.setState({userInput: ""})
}

render() {
  return (
    <div>
      { /* ... */ }
      <input type="text" onChange={this.handleChange} placeholder="Add a book to your bookshelf" />
      <button onClick={this.handleClick}>Add Book</button>
    </div>
  )
}
```

Our handleClick function is only three lines, but they are important ones:

1. `const dbRef = firebase.database().ref();` : First, as usual, we grab our reference to the current database.

2. `dbRef.push(this.state.userInput);` : We grab whatever the current value of `this.state.userInput` is (this will be whatever the user has typed in the input field), and push that into the database.

3. `this.setState({userInput: ' '})` : We reset the state of `userInput` to an empty string, effectively clearing the input.

We're almost there! Now we have to be able to remove the data.

## Removing Data
We now have the ability to add new books and retrieve existing books from our database – the final step is to add the ability to remove books from our bookshelf.

If we go back and look at our database in the Firebase dashboard, we can see that all of our data is stored as key value pairs in a structure very similar to an object.

Each book has a corresponding key. We can tell Firebase which book we want to remove using the book's id.

The first thing we'll need to do is change the structure of the data that we're currently getting back from Firebase. Right now, we grab each one of the books from our database and store it in an array as a series of strings, like this:

`["Who Will Run The Frog Hospital?", "Slaughterhouse Five"]`

So right now we aren't storing any reference to each one of these books' ids. Let's modify our data so we can get the ID as well and store it.

We'll need to modify our `componentDidMount` lifecycle hook:

```javascript
componentDidMount() {
      // ...
      for (let key in data) {
        newState.push({key: key, name: data[key]});
      }

      //...
}
```

Now, instead of pushing a string, we're pushing in an object with two properties:

1. a key, which refers to the unique id of the book inside the Firebase database
and
2. the actual book title

This means that stored inside of `this.state.books` is now going to be an array of objects, rather than an array of strings, so we'll need to modify our render method to reflect this:


```javascript
render() {
    return (
      <div>
        <ul>
        {this.state.books.map((book, i) => {
          return (
            <li key={i}>
              {book.name} - {book.key}
            </li>
          )
        })}
        </ul>
        <input type="text" placeholder="Add a book to your bookshelf" value={this.state.value} onChange={this.handleChange} />
        <button onClick={this.handleClick}>Add Book</button>
      </div>
    )
  }
```

Now that we're grabbing our book ID, we need to add a 'Remove' button that has a click event on it that will tell Firebase which ID we want to remove:

```javascript
<li key={i}>
  {book.name} <button onClick={() => this.removeBook(book.key)}> Remove </button>
</li>
```

The reason that we use `() => this.removeBook(book.key)` here is that we are actually passing a reference to a function, rather than calling the function itself. If this is confusing for you right now don't worry about it too much, just remember that you may need to do this in order to pass data from your component!

Now let's write our `removeBook` function inside our App component:

```javascript
removeBook(bookId) {
  const dbRef = firebase.database().ref(bookId);
  dbRef.remove();
}
```

Here we are:
1. Grabbing a reference to our database. By passing in the specific `bookId` we sent up from inside of our `render` method, we can grab the specific book that the user clicked 'remove' on.

2. Remove that item from the database by calling `.remove()`

You'll notice that your app automatically updates to remove that item from your page! This is because of the `.on('value')` event listener!

### Additional Resources
* [Firebase Documentation](https://firebase.google.com/docs/web/setup)